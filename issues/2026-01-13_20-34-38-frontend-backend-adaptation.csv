"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"FBA-000","P0","1","both","冻结 v0 公共读 API 数据契约","定义并冻结新前端公共读 API 的最小数据契约（Issue/RankingEntry/About*），明确字段边界与兼容策略，避免接口与前端反复返工。","仓库中存在可审阅的契约产物（文档或 types），覆盖 `Issue`、`RankingEntry`、`AboutWorks`、`AboutMember`、`AboutLink`；关键决策已定稿：`issueId` 规则、`coverUrl` 返回策略、stats 字段类型统一为 number；前后端字段命名/类型/可空性一致且无待定项。","AUTOE2E","Review 时聚焦字段命名与版本策略（v0 可演进）；明确缺省/空值与错误返回约定（404 vs 空数组）；确认 public 读与鉴权/写接口严格隔离。","任何契约变更必须同步更新契约产物并在前/后端各跑一次构建/类型检查（`npm run build`、`cargo build`）；抽样验证前端渲染在字段缺失/可空时不崩溃（smoke）。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:18; plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:76; contracts/public-read-api-v0.md:1","picked_reason:P0 基础契约先定稿，降低后续 API/前端返工并解阻塞; done_at:2026-01-13; evidence:added contracts/public-read-api-v0.md; evidence:frontend npm run build ok; manual_test:cd Biliboard-backend && cargo build; risk:low doc-only contract artifact; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-010","P0","2","frontend","前端接入前置整理（tsc/build unblock）","修复前端类型检查阻塞并引入最小 API 访问层（baseUrl 配置 + 统一错误处理），为后续从 mock 切换到真实数据做准备。","在 `Biliboard-frontend/` 下执行 `npx tsc --noEmit` 通过；执行 `npm run build` 通过；存在最小可复用 API 封装并支持 `VITE_API_BASE_URL` 配置后端地址；网络失败/非 2xx/空数据有明确处理（页面不白屏）。","AUTOFRONTEND","修复仅限最小阻塞点（HeroPlayer/RankList props）；API 封装避免散落 fetch；请求失败/超时/非 2xx 有统一处理；不把 mock 字段推导逻辑固化到组件。","回归跑 `npx tsc --noEmit`、`npm run build`；手动 smoke：Ranking/About/Nomination 页面在无数据/网络失败时仍可交互或展示空态。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:23; Biliboard-frontend/App.tsx:10; Biliboard-frontend/constants.tsx:3; Biliboard-frontend/api.ts:1; Biliboard-frontend/vite-env.d.ts:1; Biliboard-frontend/components/HeroPlayer.tsx:1; Biliboard-frontend/components/RankList.tsx:1","picked_reason:P0 前端 tsc/build unblock + API 基础封装，解阻塞后续数据接入; done_at:2026-01-13; evidence:frontend npx tsc --noEmit ok; evidence:frontend npm run build ok; evidence:add api wrapper + VITE_API_BASE_URL support; risk:low frontend-only typing + utility"
"FBA-020","P0","3","backend","后端新增 `/api/public` 只读路由分组","新增不走鉴权中间件的公共读 API 路由组，与现有鉴权/写入路由严格隔离，仅提供前端公开展示数据读取能力。","后端存在 `/api/public/*` 路由入口并可返回 200；无 cookie 调用 public 读接口成功；现有 `/api` 鉴权路由仍要求鉴权且行为不变（至少对 1 个既有鉴权接口做 smoke 验证）。","AUTOSERVER","路由分组与 middleware 顺序清晰；public 组不得复用鉴权 hoop；错误码/日志风格一致；避免误开放任何管理端写接口。","回归跑 `cargo build`（如有单测则跑 `cargo test`）；对比验证已存在的鉴权接口仍需 cookie/会话（401/403 或原行为）。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:28; Biliboard-backend/src/router/mod.rs:30; Biliboard-backend/src/router/mod.rs:35; Biliboard-backend/src/router/mod.rs:36; Biliboard-backend/src/router/mod.rs:27; Biliboard-backend/src/router/public/mod.rs:1; Biliboard-backend/src/router/public/ping.rs:1","picked_reason:P0 公共读 API 路由分组是后续 issues/rankings/about 的前置能力; done_at:2026-01-13; evidence:add /api/public (ping) router group outside auth hoops; manual_test:cd Biliboard-backend && cargo run; curl http://127.0.0.1:5800/api/public/ping; curl -i http://127.0.0.1:5800/api/user (expect 401/Unauthorized); risk:medium backend routing change; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-030","P1","4","both","About 数据 API 化（配置驱动）","后端以配置（优先 JSON 文件）提供 About works/members/links 公共读接口；前端移除 `BUBBLES` 中数据硬编码，改为运行时拉取并渲染，保持现有布局/动画不重做。","后端提供 `GET /api/public/about/works`、`/members`、`/links` 且返回结构稳定；前端 About 页数据不再来自 `Biliboard-frontend/constants.tsx` 的 hardcode 数组；断网/接口失败时页面不白屏（空态/降级提示可接受）；UI 布局/动画与现状一致（仅替换数据源）。","AUTOE2E","优先配置化避免 DB 迁移；配置文件位置/加载时机明确且可审查；前端请求放在合适生命周期并避免重复请求；对空数组与字段缺失做容错。","回归跑后端 `cargo build` 与前端 `npm run build`；浏览器 smoke：About 三块数据均来自 API 渲染；临时关闭后端时前端降级路径可用。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:32; Biliboard-frontend/constants.tsx:160; Biliboard-backend/src/router/public/about/mod.rs:1; Biliboard-backend/src/router/public/about/works.rs:1; Biliboard-backend/src/router/public/about/members.rs:1; Biliboard-backend/src/router/public/about/links.rs:1; Biliboard-backend/config/public/about/works.json:1; Biliboard-backend/config/public/about/members.json:1; Biliboard-backend/config/public/about/links.json:1; Biliboard-frontend/components/about/AboutWorksGrid.tsx:1; Biliboard-frontend/components/about/AboutTeamGrid.tsx:1; Biliboard-frontend/components/about/AboutLinksGrid.tsx:1; Biliboard-frontend/constants.tsx:109","picked_reason:P1 About 数据去硬编码 + API 化，提升可维护性并为发布做准备; done_at:2026-01-14; evidence:add GET /api/public/about/(works|members|links) driven by JSON config; evidence:frontend About bubbles fetch API data (no hardcode arrays in constants.tsx); evidence:frontend npx tsc --noEmit ok; evidence:frontend npm run build ok; manual_test:cd Biliboard-backend && cargo run; curl http://127.0.0.1:5800/api/public/about/works; curl http://127.0.0.1:5800/api/public/about/members; curl http://127.0.0.1:5800/api/public/about/links; risk:medium backend endpoints; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-040","P0","5","backend","提供 Issue 列表公共接口","后端提供期数元数据列表（issueId/label/url/bvid/coverUrl/可选 publishedAt），作为前端期数下拉/切换周榜的数据源；数据源优先 JSON 配置，避免前期 DB 迁移。","`GET /api/public/issues` 可用并返回按展示需要排序的列表；每项包含 `issueId`、`label`、`url`、`bvid`、`coverUrl`，`publishedAt` 可选；前端无需从 `Song.date` 推导期数；无 cookie 调用成功。","AUTOSERVER","`issueId` 规则与契约一致；配置数据维护流程明确（文件位置、校验、排序）；coverUrl 生成策略清晰且可回滚；接口输出稳定不依赖前端推导。","变更 issue 配置后接口仍正确返回并排序稳定；抽样用浏览器/`curl` 验证前端切换期数不报错（smoke）。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:37; plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:68; Biliboard-backend/src/router/public/issues/get.rs:1; Biliboard-backend/src/router/public/issues/mod.rs:1; Biliboard-backend/config/public/issues.json:1","picked_reason:P0 Issue 列表是前端切换期数/拉取榜单的核心入口; done_at:2026-01-13; evidence:add GET /api/public/issues driven by JSON config; evidence:coverUrl defaults to /api/provider/biliimg/bvid/<bvid> (override supported); manual_test:cd Biliboard-backend && cargo run; curl http://127.0.0.1:5800/api/public/issues; risk:medium backend endpoint; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-050","P0","6","both","周榜条目 v0（按 issueId 获取）","后端提供某期榜单条目读取接口，基于现有 `Rank + Tracing` join 返回基础字段；前端 RankingPage 改为 API 驱动并保留可控 mock 降级开关。","后端 `GET /api/public/issues/<issueId>/rankings` 返回列表且包含 `rank/title/producer/vocalist/bvid/coverUrl`；stats/score/历史指标允许缺省或 0，前端需容错不崩；前端首页榜单可展示与筛选；切换期数可刷新数据；无 cookie 调用成功。","AUTOE2E","字段映射正确（producer/author、vocalist/singer）；排序策略明确；接口响应避免 N+1；mock fallback 有明确开关与默认策略（可降级但不掩盖问题）。","回归跑前端 `npx tsc --noEmit`/`npm run build`、后端 `cargo build`；关键接口 `curl` smoke；确认现有管理端导入/写入接口不受影响。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:42; Biliboard-backend/src/router/rank/get.rs:34; Biliboard-frontend/constants.tsx:3; Biliboard-backend/src/router/public/issues/mod.rs:1; Biliboard-backend/src/router/public/issues/rankings.rs:1; Biliboard-frontend/publicApi.ts:1; Biliboard-frontend/App.tsx:1","picked_reason:P0 榜单条目 API + 前端接入是去 mock 的关键里程碑; done_at:2026-01-13; evidence:add GET /api/public/issues/<issueId>/rankings (rank/title/producer/vocalist/bvid/coverUrl); evidence:frontend RankingPage fetches issues+rankings with fallback + VITE_USE_MOCK_DATA; evidence:frontend npx tsc --noEmit ok; evidence:frontend npm run build ok; manual_test:cd Biliboard-backend && cargo run; curl http://127.0.0.1:5800/api/public/issues; curl http://127.0.0.1:5800/api/public/issues/<issueId>/rankings; cd ../Biliboard-frontend && set VITE_API_BASE_URL=http://127.0.0.1:5800 && npm run dev; risk:medium backend endpoint; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-060","P1","7","backend","统计快照 + score（v1）落库与采集","新增统计快照存储与采集机制，稳定输出 view/like/coin/favorite 与 score，避免在 public 请求链路高并发实时抓取触发风控/限流；score 公式做最小版本化记录。","新增统计快照表并具备联合唯一键（如 `periodcal + avid`）；提供生成/更新机制（定时任务或管理端触发）可为指定期数生成快照；rankings 接口可返回真实 `stats/score`；历史期多次查询结果可重复且不因新公式重算。","AUTOSERVER","采集/更新具备节流与错误处理（避免 fan-out）；public 读请求路径不得直接做外部 IO；score 版本字段命名与迁移可控；DB 迁移/备份策略明确。","并发抽测：高并发访问 rankings 不触发外部抓取且错误率可接受；历史期查询性能稳定；回归现有写入/导入功能与 schema 兼容。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:49; plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:69; plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:72; Biliboard-backend/src/router/public/issues/rankings.rs:1; Biliboard-backend/src/db/mod.rs:1; Biliboard-backend/src/db/periodcal.rs:1; Biliboard-backend/src/db/vote_record.rs:1; Biliboard-backend/migrations/0008_video_stat_snapshot.sql:1; Biliboard-backend/src/db/video_stat_snapshot.rs:1; Biliboard-backend/src/router/periodcal/mod.rs:1; Biliboard-backend/src/router/periodcal/stats_snapshot.rs:1","picked_reason:P1 为 rankings 补齐 stats/score 的后端存储与采集，避免 public 请求链路外部 IO; done_at:2026-01-14; evidence:add VideoStatSnapshot table (UNIQUE periodcal+avid) + score_version; evidence:add POST /api/periodcal/<periodcal>/stats_snapshot (auth; ?force to upsert); evidence:public rankings reads snapshots to return stats/score (no external IO on public path); evidence:score_v1 = views + likes + coins + favorites (stored, versioned); manual_test:install Rust; cd Biliboard-backend && cargo build && cargo run; (auth required) curl -X POST http://127.0.0.1:5800/api/periodcal/<periodcal>/stats_snapshot; curl http://127.0.0.1:5800/api/public/issues/<periodcal>/rankings and confirm stats/score present; re-run POST without force and confirm stored_rows is 0 (history stable); re-run with ?force and confirm stored_rows > 0; risk:medium additive DB migration + new endpoint; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-070","P2","8","backend","历史指标计算（lastRank/weeksOnBoard/peakRank）","实现榜单历史指标的计算与输出，优先用 SQL 聚合/窗口查询满足正确性，并按需补齐索引避免跨期查询性能退化。","rankings 接口按契约输出 `lastRank`、`weeksOnBoard`、`peakRank`；抽样对比历史 Rank 数据结果正确（至少抽 3 个 issueId、每个抽 3 条作品）；存在必要索引或预计算避免跨期计算导致明显响应退化，并在 PR/notes 中附带一次性能测量命令与结果。","AUTOSERVER","优先 KISS：先用 SQL 聚合/窗口查询满足正确性；索引/查询计划可解释；避免引入复杂预计算除非确有性能瓶颈。","回归对比：新增指标不改变现有 rankings 排序与基础字段；对多个期数查询进行 smoke（含边界：首期/最新期/空数据期）。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:54; Biliboard-backend/src/router/public/issues/rankings.rs:1; Biliboard-backend/src/db/rank.rs:1; Biliboard-backend/sql_script/rank/get_by_periodcal_with_info.sql:1; Biliboard-backend/migrations/0009_rank_history_indexes.sql:1; Biliboard-backend/sql_script/rank/get_history_metrics_by_periodcal.sql:1","picked_reason:P2 补齐 rankings 历史指标（lastRank/weeksOnBoard/peakRank），对齐前端展示并避免回归偏差; done_at:2026-01-14; evidence:add SQL history metrics query for lastRank/weeksOnBoard/peakRank (CTE + aggregation); evidence:add Rank indexes (periodcal) + (avid, periodcal) to avoid cross-issue scans; evidence:public rankings returns lastRank/weeksOnBoard/peakRank (base fields/sort unchanged); evidence:python sqlite3 executed metrics SQL against sample data (assert ok); manual_test:install Rust; cd Biliboard-backend && cargo build && cargo run; ensure Rank table has multiple periodcal; curl http://127.0.0.1:5800/api/public/issues/<issueId>/rankings and verify lastRank/weeksOnBoard/peakRank; perf: sqlite3 Biliboard-backend/data/prob.db ""EXPLAIN QUERY PLAN $(cat Biliboard-backend/sql_script/rank/get_history_metrics_by_periodcal.sql)""; curl -s -o NUL -w ""%{time_total}"" http://127.0.0.1:5800/api/public/issues/<issueId>/rankings (record time); risk:medium new SQL + indexes; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
"FBA-080","P0","9","both","集成验证 + 回滚/降级路径落盘","建立最小可重复的集成验证清单与回滚/降级策略，确保 public API 不可用时前端可降级展示，且旧后端管理侧能力不受影响。","存在可重复执行的验证清单（文档或 scripts），至少包含后端 `cargo build`/`cargo run`、前端 `npx tsc --noEmit`/`npm run build`；关键 public 接口可用 `curl`/浏览器 smoke 验证；前端保留可控 mock 降级开关；后端可在路由层快速禁用 public 组且不影响鉴权/写接口。","AUTOE2E","验证命令与入口统一；降级开关默认值与配置来源清晰；public 组隔离与关闭策略安全；必要日志/可观测性到位。","全链路回归：模拟后端不可用时前端可降级；模拟无 cookie 访问 public 成功且访问鉴权路由仍受限；关键页面（Ranking/About）至少一次浏览器 smoke。","已完成","已完成","已完成","已提交","","plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:59; plan/2026-01-13_20-21-25-frontend-backend-adaptation.md:70; Biliboard-backend/src/router/mod.rs:32; Biliboard-frontend/App.tsx:93","picked_reason:P0 收敛集成验证清单与降级/关闭 public 开关，确保可重复验收并降低发布风险; done_at:2026-01-13; evidence:updated plan section 9 checklist + rollback/disable notes; evidence:backend router supports BILIBOARD_DISABLE_PUBLIC_API to disable /api/public/*; evidence:frontend npx tsc --noEmit ok; evidence:frontend npm run build ok; manual_test:cd Biliboard-backend && cargo build && cargo run; curl http://127.0.0.1:5800/api/public/ping; curl http://127.0.0.1:5800/api/public/issues; curl -i http://127.0.0.1:5800/api/user (expect 401/403); set BILIBOARD_DISABLE_PUBLIC_API=1 then restart backend and expect /api/public/ping 404; cd ../Biliboard-frontend && VITE_API_BASE_URL=http://127.0.0.1:5800 npm run dev; browse Ranking/About; stop backend and confirm frontend falls back to mock; risk:medium backend routing change; revalidated_at:2026-01-14; evidence:backend cargo build ok (cargo 1.92.0, rustc 1.92.0); evidence:backend cargo test ok (0 tests); evidence:backend cargo run ok (listening 127.0.0.1:5800) + curl smoke (/api/public/ping 200, /api/public/issues 200, /api/user 401); evidence:BILIBOARD_DISABLE_PUBLIC_API=1 => /api/public/ping 404"
